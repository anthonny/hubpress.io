<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>How I use Meteor, Elm and Tailwindcss together</title>

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="How I use Meteor, Elm and Tailwindcss together">
    <meta name="twitter:description" content="">

    <meta property="og:url" content="http://anthonnyquerouil.me">
    <meta property="og:type" content="article">
    <meta property="og:title" content="How I use Meteor, Elm and Tailwindcss together">
    <meta property="og:description" content="">
    <meta property="og:site_name" content="Anthonny Quérouil">

    <meta itemprop="name" content="How I use Meteor, Elm and Tailwindcss together">
    <meta itemprop="description" content="">

    <link rel="stylesheet" href="//anthonnyquerouil.me/themes/indigo-theme/assets/main.03ed2e54.css?v=1592551695646">
    <link rel="stylesheet" href="//anthonnyquerouil.me/themes/indigo-theme/assets/main.866fd06b.css?v=1592551695646">

    <link rel="canonical" href="http://anthonnyquerouil.me/2020/06/17/how-i-use-meteor-elm-and-tailwindcss-together.html" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:site_name" content="Anthonny Quérouil" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="How I use Meteor, Elm and Tailwindcss together" />
    <meta property="og:description" content="I have worked with Elm last year and honestly it was an great experience. I really liked it and I would like to use Elm in all my new projects. But I also like Meteor and three weeks ago I started using it again. I discovered Meteor in 2015, I" />
    <meta property="og:url" content="http://anthonnyquerouil.me/2020/06/17/how-i-use-meteor-elm-and-tailwindcss-together.html" />
    <meta property="article:published_time" content="2020-06-17T00:00:00.000Z" />
    <meta property="article:tag" content="meteor" />
    <meta property="article:tag" content="elm" />
    <meta property="article:tag" content="parcel" />
    <meta property="article:tag" content="tailwindcss" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="How I use Meteor, Elm and Tailwindcss together" />
    <meta name="twitter:description" content="I have worked with Elm last year and honestly it was an great experience. I really liked it and I would like to use Elm in all my new projects. But I also like Meteor and three weeks ago I started using it again. I discovered Meteor in 2015, I" />
    <meta name="twitter:url" content="http://anthonnyquerouil.me/2020/06/17/how-i-use-meteor-elm-and-tailwindcss-together.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Anthonny Quérouil",
    "author": {
        "@type": "Person",
        "name": "Anthonny Quérouil",
        "image": "https://avatars1.githubusercontent.com/u/2006548?v=4",
        "url": "http://anthonnyquerouil.me/author/anthonny/",
        "sameAs": "http://www.anthonnyquerouil.fr"
    },
    "headline": "How I use Meteor, Elm and Tailwindcss together",
    "url": "http://anthonnyquerouil.me/2020/06/17/how-i-use-meteor-elm-and-tailwindcss-together.html",
    "datePublished": "2020-06-17T00:00:00.000Z",
    "keywords": "meteor, elm, parcel, tailwindcss",
    "description": "I have worked with Elm last year and honestly it was an great experience. I really liked it and I would like to use Elm in all my new projects. But I also like Meteor and three weeks ago I started using it again. I discovered Meteor in 2015, I"
}
    </script>

    <meta name="generator" content="HubPress" />
    <link rel="alternate" type="application/rss+xml" title="Anthonny Quérouil" href="http://anthonnyquerouil.me/rss/" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/themes/prism-okaidia.min.css">
    
        <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
</head>

<body class="post-template tag-meteor tag-elm tag-parcel tag-tailwindcss w-screen h-screen flex justify-center bg-white text-gray-900">
    <main class="w-full h-full max-w-800 flex flex-col">
        <header class="mt-2 flex items-center justify-between px-4 py-1 text-indigo-800">
            <section class="hidden md:block uppercase font-bold">
                Anthonny Quérouil :: Blog
            </section>
            <section class="md:hidden uppercase font-bold">
                AQ :: Blog
            </section>
            <section>
                <ul class="flex items-center text-indigo-800">
                    <li class="ml-2 hover:text-indigo-600 fill-current">
                        <a href="#">
                            <svg width="28" height="28" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M10 1.25C5.16797 1.25 1.25 5.16797 1.25 10C1.25 14.832 5.16797 18.75 10 18.75C14.832 18.75 18.75 14.832 18.75 10C18.75 5.16797 14.832 1.25 10 1.25ZM14.2051 7.8457C14.2109 7.9375 14.2109 8.0332 14.2109 8.12695C14.2109 10.9941 12.0273 14.2969 8.03711 14.2969C6.80664 14.2969 5.66602 13.9395 4.70508 13.3242C4.88086 13.3438 5.04883 13.3516 5.22852 13.3516C6.24414 13.3516 7.17773 13.0078 7.92188 12.4258C6.96875 12.4063 6.16797 11.7813 5.89453 10.9219C6.22852 10.9707 6.5293 10.9707 6.87305 10.8828C6.38228 10.7831 5.94116 10.5166 5.62464 10.1285C5.30812 9.7404 5.13572 9.2547 5.13672 8.75391V8.72656C5.42383 8.88867 5.76172 8.98828 6.11523 9.00195C5.81805 8.8039 5.57433 8.53557 5.40569 8.22076C5.23704 7.90596 5.14868 7.5544 5.14844 7.19727C5.14844 6.79297 5.25391 6.42383 5.44336 6.10352C5.98809 6.77409 6.66783 7.32254 7.43841 7.71321C8.20898 8.10389 9.05314 8.32803 9.91602 8.37109C9.60938 6.89648 10.7109 5.70312 12.0352 5.70312C12.6602 5.70312 13.2227 5.96484 13.6191 6.38672C14.1094 6.29492 14.5781 6.11133 14.9961 5.86523C14.834 6.36719 14.4941 6.79102 14.043 7.05859C14.4805 7.01172 14.9023 6.89063 15.293 6.7207C14.998 7.1543 14.6289 7.53906 14.2051 7.8457V7.8457Z" />
                            </svg>
                        </a>
                    </li>
                    <li class="ml-2 hover:text-indigo-600 fill-current">
                        <a href="#">
                            <svg width="28" height="28" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M9.99219 1.49024C5.16211 1.48828 1.25 5.39844 1.25 10.2246C1.25 14.041 3.69727 17.2852 7.10547 18.4766C7.56445 18.5918 7.49414 18.2656 7.49414 18.043V16.5293C4.84375 16.8398 4.73633 15.0859 4.55859 14.793C4.19922 14.1797 3.34961 14.0234 3.60352 13.7305C4.20703 13.4199 4.82227 13.8086 5.53516 14.8613C6.05078 15.625 7.05664 15.4961 7.56641 15.3691C7.67773 14.9102 7.91602 14.5 8.24414 14.1816C5.49805 13.6895 4.35352 12.0137 4.35352 10.0215C4.35352 9.05469 4.67188 8.16602 5.29688 7.44922C4.89844 6.26758 5.33398 5.25586 5.39258 5.10547C6.52734 5.00391 7.70703 5.91797 7.79883 5.99024C8.44336 5.81641 9.17969 5.72461 10.0039 5.72461C10.832 5.72461 11.5703 5.82031 12.2207 5.99609C12.4414 5.82813 13.5352 5.04297 14.5898 5.13867C14.6465 5.28906 15.0723 6.27734 14.6973 7.44336C15.3301 8.16211 15.6523 9.0586 15.6523 10.0273C15.6523 12.0234 14.5 13.7012 11.7461 14.1855C11.982 14.4175 12.1693 14.6942 12.297 14.9993C12.4248 15.3045 12.4905 15.6321 12.4902 15.9629V18.1602C12.5059 18.3359 12.4902 18.5098 12.7832 18.5098C16.2422 17.3438 18.7324 14.0762 18.7324 10.2266C18.7324 5.39844 14.8184 1.49024 9.99219 1.49024V1.49024Z" />
                            </svg>
                        </a>
                    </li>
                    <li class="ml-2 hover:text-indigo-600 fill-current">
                        <a href="#">
                            <svg width="26" height="26" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M10 0.400024C4.69802 0.400024 0.400024 4.69802 0.400024 10C0.400024 15.302 4.69802 19.6 10 19.6C15.302 19.6 19.6 15.302 19.6 10C19.6 4.69802 15.302 0.400024 10 0.400024ZM7.65002 13.979H5.70602V7.72302H7.65002V13.979ZM6.66602 6.95502C6.05202 6.95502 5.65502 6.52002 5.65502 5.98202C5.65502 5.43302 6.06402 5.01102 6.69102 5.01102C7.31802 5.01102 7.70202 5.43302 7.71402 5.98202C7.71402 6.52002 7.31802 6.95502 6.66602 6.95502ZM14.75 13.979H12.806V10.512C12.806 9.70502 12.524 9.15702 11.821 9.15702C11.284 9.15702 10.965 9.52803 10.824 9.88503C10.772 10.012 10.759 10.192 10.759 10.371V13.978H8.81402V9.71803C8.81402 8.93703 8.78902 8.28402 8.76302 7.72202H10.452L10.541 8.59102H10.58C10.836 8.18302 11.463 7.58102 12.512 7.58102C13.791 7.58102 14.75 8.43802 14.75 10.28V13.979V13.979Z" />
                            </svg>
                        </a>
                    </li>
                </ul>
            </section>
        </header>
        <section class="flex-1 content mt-12">
            <section class="flex-1 px-4 xs:px-12 sm:px-24 md:px-40">
    <section class="post">
        <header>
            <section class="flex text-gray-600">
                <section class="published-at">
                    <time datetime="2020-06-17" itemprop="datePublished">
                        2 days ago
                    </time>
                </section>
                <section>
                    <ul class="flex tags">
                        <li><a href="/">meteor</a></li>
                        <li><a href="/">elm</a></li>
                        <li><a href="/">parcel</a></li>
                        <li><a href="/">tailwindcss</a></li>
                    </ul>
                </section>
            </section>
            <h1 class="mt-12 text-2xl sm:text-3xl md:text-4xl text-indigo-800 font-bold">
                How I use Meteor, Elm and Tailwindcss together
            </h1>

        </header>
        <section class="flex-1 content mt-12">
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>I have worked with <a href="https://elm-lang.org/">Elm</a> last year and honestly it was an great experience.
I really liked it and I would like to use <a href="https://elm-lang.org/">Elm</a> in all my new projects.
But I also like <a href="https://www.meteor.com/">Meteor</a> and three weeks ago I started using it again.
I discovered <a href="https://www.meteor.com/">Meteor</a> in 2015, I gave a talk about it (<a href="https://www.youtube.com/watch?v=AxIvfQXTqVo" class="bare">https://www.youtube.com/watch?v=AxIvfQXTqVo</a>) and it still feels like "Wow!" when you start a project.
So in this post I will explain how I make the two work together and how to add <a href="https://tailwindcss.com/">Tailwindcss</a> for the UI part (I love <a href="https://tailwindcss.com/">Tailwindcss</a> too 😍), from scratch.
I will also explain how to link an existing project to <a href="https://www.meteor.com/">Meteor</a> with a Todo app.</p>
</div>
<hr>
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_prerequisite">Prerequisite</a></li>
<li><a href="#_meteor">Meteor</a>
<ul class="sectlevel2">
<li><a href="#_install_meteor">Install Meteor</a></li>
<li><a href="#_create_a_project">Create a project</a></li>
<li><a href="#_add_typescript">Add typescript</a></li>
<li><a href="#_create_the_file_structure">Create the file structure</a></li>
<li><a href="#_checkpoint">Checkpoint</a></li>
</ul>
</li>
<li><a href="#_elm">Elm</a>
<ul class="sectlevel2">
<li><a href="#_install_parcel">Install Parcel</a></li>
<li><a href="#_create_a_meteor_package">Create a Meteor package</a></li>
<li><a href="#_create_the_app">Create the app</a></li>
<li><a href="#_the_css_main_file">The CSS main file</a></li>
<li><a href="#_the_package_mainmodule">The Package mainModule</a></li>
<li><a href="#_build_with_parcel">Build with Parcel</a></li>
<li><a href="#_add_our_package_to_meteor">Add our package to Meteor</a></li>
<li><a href="#_post_install">Post install</a></li>
</ul>
</li>
<li><a href="#_use_the_elm_application_in_our_meteor_client">Use the Elm application in our Meteor client</a>
<ul class="sectlevel2">
<li><a href="#_the_typing_is_not_good">The typing is not good</a></li>
</ul>
</li>
<li><a href="#_live_reload">Live Reload</a></li>
<li><a href="#_tailwindcss">Tailwindcss</a></li>
<li><a href="#_the_todos_application">The Todos application</a>
<ul class="sectlevel2">
<li><a href="#_update_the_main_elm">Update the Main.elm</a></li>
<li><a href="#_define_the_todos_collection_and_methods">Define the Todos collection and methods</a></li>
<li><a href="#_add_ports_to_the_elm_application">Add ports to the Elm application</a></li>
<li><a href="#_link_ports_to_meteor_methods_and_subscriptions">Link ports to Meteor.methods and subscriptions</a></li>
</ul>
</li>
<li><a href="#_conclusion">Conclusion</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisite">Prerequisite</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You only need two things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Your favourite IDE (VSCode with the <a href="https://marketplace.visualstudio.com/items?itemName=Elmtooling.elm-ls-vscode">Elm extension</a> fits very well)</p>
</li>
<li>
<p>A browser</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You don&#8217;t need to install NPM, Node or Mongo.
All this stuff is already packaged in <a href="https://www.meteor.com/">Meteor</a> environment.</p>
</div>
<div class="paragraph">
<p>So to run a NPM command we will use <code>meteor npm xxx</code>, and for Mongo, we will use <code>meteor mongo</code>.</p>
</div>
<div class="paragraph">
<p>So let&#8217;s begin 😁</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_meteor">Meteor</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_install_meteor">Install Meteor</h3>
<div class="imageblock">
<div class="content">
<img src="https://user-images.githubusercontent.com/2006548/84738510-53981b80-afaa-11ea-8d02-cdf6c42c26c0.png" alt="84738510 53981b80 afaa 11ea 8d02 cdf6c42c26c0">
</div>
</div>
<div class="paragraph">
<p>Here are the commands to install <a href="https://www.meteor.com/">Meteor</a> on OSX/Linux and Windows
OSX / Linux</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell"># OSX/Linux
curl https://install.meteor.com/ | sh

# Windows
choco install meteor</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more information about the installation, please refer to the official documentation here <a href="https://www.meteor.com/install" class="bare">https://www.meteor.com/install</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_project">Create a project</h3>
<div class="paragraph">
<p>Let&#8217;s start by creating an empty project</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">meteor create meteor-elm-app --bare
cd meteor-elm-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>--bare</code> option will create an empty project with static-html instead of blaze and without autopublish and insecure.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more information about the command create, follow the link <a href="https://docs.meteor.com/commandline.html#meteorcreate" class="bare">https://docs.meteor.com/commandline.html#meteorcreate</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_add_typescript">Add typescript</h3>
<div class="paragraph">
<p>Adding Typescript is really simple.
Just run these two commands</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell"># under meteor-elm-app
meteor add typescript
meteor npm i -D @types/meteor @types/mocha</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a tsconfig.json under the directory <strong>meteor-elm-app</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "compilerOptions": {
      /* Basic Options */
      "target": "es2018",
      "module": "esNext",
      "lib": ["esnext", "dom"],
      "allowJs": true,
      "checkJs": false,
      "incremental": false,
      "noEmit": true,

      /* Strict Type-Checking Options */
      "strict": true,
      "noImplicitAny": true,
      "strictNullChecks": true,

      /* Additional Checks */
      "noUnusedLocals": true,
      "noUnusedParameters": true,
      "noImplicitReturns": false,
      "noFallthroughCasesInSwitch": false,

      /* Module Resolution Options */
      "baseUrl": ".",
      "paths": {
        /* Support absolute ~imports/* with a leading '/' */
        "/*": ["*"]
      },
      "moduleResolution": "node",
      "resolveJsonModule": true,
      "types": ["node", "mocha"],
      "esModuleInterop": true,
      "preserveSymlinks": true,
    },
    "exclude": [
      "./.meteor/**",
      "./packages/**"
    ]
  }</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This configuration comes from the typescript template provided by <a href="https://www.meteor.com/">Meteor</a>.
I just removed the support of JSX.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_create_the_file_structure">Create the file structure</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We will setup a simple file structure here.
For more complex projects, you should follow the guideline provided by <a href="https://www.meteor.com/">Meteor</a> <a href="https://guide.meteor.com/structure.html#javascript-structure" class="bare">https://guide.meteor.com/structure.html#javascript-structure</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To initialise the file structure, run these commands</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell"># under meteor-elm-app
mkdir client server imports/api
touch client/main.html client/main.ts client/main.css server/main.ts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your project folder should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell"># under meteor-elm-app
❯ tree -I node_modules
.
├── client
│   ├── main.css
│   ├── main.html
│   └── main.ts
├── imports
│   └── api
├── package-lock.json
├── package.json
├── server
│   └── main.ts
└── tsconfig.json

4 directories, 7 files</code></pre>
</div>
</div>
<div class="paragraph">
<p>We will update the <strong>package.json</strong> file to define the main modules in our <a href="https://www.meteor.com/">Meteor</a> app:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"meteor": {
    "mainModule": {
        "client": "client/main.ts",
        "server": "server/main.ts"
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point your <strong>package.json</strong> file should be like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "name": "meteor-elm-app",
  "private": true,
  "scripts": {
    "start": "meteor run"
  },
  "meteor": {
    "mainModule": {
      "client": "client/main.ts",
      "server": "server/main.ts"
    }
  },
  "dependencies": {
    "@babel/runtime": "^7.8.3",
    "meteor-node-stubs": "^1.0.0"
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if you need more informations about this mainModule options, you can read the content of this pull request <a href="https://github.com/meteor/meteor/pull/9690" class="bare">https://github.com/meteor/meteor/pull/9690</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We now need to add some basic content to the <strong>main.html</strong> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;head&gt;
  &lt;title&gt;meteor-elm-app&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;div id="main"&gt;Elm app will be here&lt;/div&gt;
&lt;/body&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_checkpoint">Checkpoint</h3>
<div class="paragraph">
<p>Lets check if everything is OK before starting with <a href="https://elm-lang.org/">Elm</a>.
Start your <strong>meteor</strong> server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell"># under meteor-elm-app
meteor</code></pre>
</div>
</div>
<div class="paragraph">
<p>Open <a href="http://localhost:3000" class="bare">http://localhost:3000</a> on your favorite browser
You should see this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://user-images.githubusercontent.com/2006548/84446744-8195fc80-ac46-11ea-9da8-4fd2033898bf.png" alt="84446744 8195fc80 ac46 11ea 9da8 4fd2033898bf">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_elm">Elm</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_install_parcel">Install Parcel</h3>
<div class="paragraph">
<p>We will use <a href="https://parceljs.org/">Parcel</a> to build our <a href="https://elm-lang.org/">Elm</a> application and we will use the result of this build in our <a href="https://www.meteor.com/">Meteor</a> application</p>
</div>
<div class="paragraph">
<p>To install <a href="https://parceljs.org/">Parcel</a>, run this command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">meteor npm i -D parcel</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_meteor_package">Create a Meteor package</h3>
<div class="paragraph">
<p>This <a href="https://www.meteor.com/">Meteor</a> package will contain our <a href="https://elm-lang.org/">Elm</a> application and we will use this package inside the <a href="https://www.meteor.com/">Meteor</a> application.</p>
</div>
<div class="paragraph">
<p>We use a Package because it allows us to isolate our <a href="https://elm-lang.org/">Elm</a> application from the rest of the <a href="https://www.meteor.com/">Meteor</a> context.
It is also really useful if we want to remove our <a href="https://elm-lang.org/">Elm</a> application or if one we don&#8217;t want to use <a href="https://www.meteor.com/">Meteor</a> anymore.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start by creating some folders:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">mkdir -p packages/elm-app/{app,dist}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>app</strong> folder will contain the sources of our <a href="https://elm-lang.org/">Elm</a> application (<a href="https://elm-lang.org/">Elm</a>, TS and CSS files).
The <strong>dist</strong> folder will contain the result of the build made by <a href="https://parceljs.org/">Parcel</a>.</p>
</div>
<div class="paragraph">
<p>Because we will build with <a href="https://parceljs.org/">Parcel</a> and not with <a href="https://www.meteor.com/">Meteor</a>, we will create a new file at the root of the <strong>meteor-elm-app</strong> called <strong>.meteorignore</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#under meteor-elm-app
touch .meteorignore</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then add this line inside this new file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>/packages/elm-app/app/**/*</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because we don&#8217;t want to push the <strong>dist</strong> and the <strong>elm-stuff</strong> folders on our repository, we will add them in the <strong>.gitignore</strong> located under the folder <strong>meteor-elm-app</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>dist
elm-stuff</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s create a <strong>package.js</strong> file in our package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#under meteor-elm-app/packages/elm-app
touch package.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>And add the following content in this file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">Package.describe({
    name: 'elm-app',
    version: '1.0.0',
    summary: 'elm app',
    documentation: 'add your elm app into meteor',
});

Package.onUse(function (api) {
    api.versionsFrom('1.10.2');
    api.use('modules');
    api.addFiles('dist/elm-app.css', 'client');
    api.mainModule('dist/elm-app.js', 'client');
});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Package.describe</strong> says that our package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>is called <code>elm-app</code>,</p>
</li>
<li>
<p>is in version <code>1.0.0</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>Package.onUse</code> says that our package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>is implemented to be use with <a href="https://www.meteor.com/">Meteor</a> <code>1.10.2</code>,</p>
</li>
<li>
<p>uses the <code>modules</code> package, so we will be able to use <code>import {} from ''</code>,</p>
</li>
<li>
<p>will add the <code>dist/elm-app.css</code> file in the client when it will be loaded,</p>
</li>
<li>
<p>have a main js file for this package called <code>dist/elm-app.js</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are using <strong>elm-css</strong> and if you don&#8217;t need specific css classes in your app, you can remove <code>api.addFiles('dist/elm-app.css', 'client');</code> from the <strong>package.js</strong> file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more informations about the Package.js file, see <a href="https://docs.meteor.com/api/packagejs.html" class="bare">https://docs.meteor.com/api/packagejs.html</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_create_the_app">Create the app</h3>
<div class="paragraph">
<p>We will create our <a href="https://elm-lang.org/">Elm</a> application under the folder <strong>packages/elm-app/app</strong>.</p>
</div>
<div class="paragraph">
<p>We need to install <a href="https://elm-lang.org/">Elm</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">meteor npm i -D elm elm-format</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
elm-format is not mandatory but you should use it with your IDE to format on save and to avoid problem at compile time
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then we will initialise our app with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#under meteor-elm-app/packages/elm-app/app
meteor npx elm init</code></pre>
</div>
</div>
<div class="paragraph">
<p>Validate the creation of the <strong>elm.json</strong> file and we are good 👍.</p>
</div>
<div class="paragraph">
<p>At this step, your folder should be like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#under meteor-elm-app
❯ tree -I 'node_modules|.meteor' -a
.
├── .gitignore
├── .meteorignore
├── client
│   ├── main.css
│   ├── main.html
│   └── main.ts
├── imports
│   └── api
├── package-lock.json
├── package.json
├── packages
│   └── elm-app
│       ├── app
│       │   ├── elm.json
│       │   └── src
│       ├── dist
│       └── package.js
├── server
│   └── main.ts
└── tsconfig.json

9 directories, 11 files</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a first time, we will create a simple <a href="https://elm-lang.org/">Elm</a> application.</p>
</div>
<div class="paragraph">
<p>Create a <strong>Main.elm</strong> file inside the folder <strong>packages/elm-app/app/src</strong> with this content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-elm" data-lang="elm">module Main exposing(main)

import Browser
import Html exposing (Html, text)

type alias Model = String

main : Program () Model msg
main =
    Browser.element
        { init = init
        , view = view
        , update = update
        , subscriptions = subscriptions
        }

init: () -&gt; (Model, Cmd msg)
init _ =
    ("Hello from Elm app", Cmd.none)

view: Model -&gt; Html msg
view model =
    text model

update: msg -&gt; Model -&gt; (Model, Cmd msg)
update _ model =
    (model, Cmd.none)

subscriptions : Model -&gt; Sub msg
subscriptions _ =
    Sub.none</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_css_main_file">The CSS main file</h3>
<div class="paragraph">
<p>In the folder <strong>meteor-elm-app/packages/elm-app/app</strong>, create an empty <strong>main.scss</strong> SCSS file (or CSS if you prefer) that we will use later to add some style in our <a href="https://elm-lang.org/">Elm</a> application.</p>
</div>
<div class="paragraph">
<p>NB: if you use <strong>elm-css</strong> and you don&#8217;t need a stylesheet, skip this step and remove the line <code>api.addFiles('dist/elm-app.css', 'client');</code> in the <strong>package.js</strong> file</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_package_mainmodule">The Package mainModule</h3>
<div class="paragraph">
<p>In the folder <strong>meteor-elm-app/packages/elm-app/app</strong>, create a file <strong>index.ts</strong> that will <strong>mount</strong> our <a href="https://elm-lang.org/">Elm</a> application and export the <strong>ports</strong>.</p>
</div>
<div class="paragraph">
<p>A simple version could be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">import './main.scss'
const { Elm } = require('./src/Main.elm')

export const init = (configuration: any) =&gt; {
    const app = Elm.Main.init(configuration)
    return app.ports
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>But because we want to <strong>Type</strong> things as much as possible, let&#8217;s create this <strong>index.ts</strong> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">import './main.scss'
const { Elm } = require('./src/Main.elm')

interface Flags {}

export interface Configuration {
    node: HTMLElement | null,
    flags: Flags
}

export interface Ports {}

export const init: (configuration: Configuration) =&gt; Ports = (configuration) =&gt; {
    const app = Elm.Main.init(configuration)
    return app.ports
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this definition, when we will need some flags or some ports, we will add the new stuff in our interface and the client will have to implement them.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are using <strong>CSS</strong> instead of <strong>SCSS</strong> then update the file import accordingly
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_build_with_parcel">Build with Parcel</h3>
<div class="paragraph">
<p>Let&#8217;s create a build script in our <strong>package.json</strong> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"elm:build": "parcel build packages/elm-app/app/index.ts -d packages/elm-app/dist --out-file elm-app.js --no-cache",</code></pre>
</div>
</div>
<div class="paragraph">
<p>This script will build our application in a file <strong>elm-app.js</strong> (and <strong>elm-app.css</strong>) and put it in the folder <strong>packages/elm-app/dist</strong> (the one we added in our <strong>.gitignore</strong>)</p>
</div>
<div class="paragraph">
<p>We can test our script</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#under meteor-elm-app
meteor npm run elm:build</code></pre>
</div>
</div>
<div class="paragraph">
<p>If everything is ok, you should see these lines:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://user-images.githubusercontent.com/2006548/84450020-4ea43680-ac4f-11ea-9b45-ce0dfb572835.png" alt="84450020 4ea43680 ac4f 11ea 9b45 ce0dfb572835">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_add_our_package_to_meteor">Add our package to Meteor</h3>
<div class="paragraph">
<p>Now that we have a package, we have to add it in our <a href="https://www.meteor.com/">Meteor</a> configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
you must have run the previous build command before adding the package because without a dist folder, you will not be able to add it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Execute this command to add the package</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#under meteor-elm-app
meteor add elm-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://user-images.githubusercontent.com/2006548/84450082-7abfb780-ac4f-11ea-92f4-db936ee6f726.png" alt="84450082 7abfb780 ac4f 11ea 92f4 db936ee6f726">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_post_install">Post install</h3>
<div class="paragraph">
<p>To avoid to have to compile manually each time someone clone the repository, we will add a <code>postinstall</code> script in the <strong>package.json</strong> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"postinstall": "meteor npm run elm:build",</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_use_the_elm_application_in_our_meteor_client">Use the Elm application in our Meteor client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we have our <a href="https://elm-lang.org/">Elm</a> application, it is time to import it in the client side of our <a href="https://www.meteor.com/">Meteor</a> application</p>
</div>
<div class="paragraph">
<p>In the <strong>client/main.ts</strong> file, add the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">import { init } from "meteor/elm-app";
import { Meteor } from 'meteor/meteor';

Meteor.startup(() =&gt; {
    const ports = init({
        node: document.getElementById("main"),
        flags: {}
    })
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this code, we import the <code>init</code> function from the package <code>meteor/elm-app</code> which is the package we have just created (you can see it in the file <strong>.meteor/packages</strong>).
Then we call it to mount our <a href="https://elm-lang.org/">Elm</a> application on the node <code>document.getElementById("main")</code> (the one we have created in the <strong>main.html</strong> file)</p>
</div>
<div class="paragraph">
<p>Now, if you start your meteor application by running the <code>meteor</code> command, on <a href="http://localhost:3000" class="bare">http://localhost:3000</a> you should see:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://user-images.githubusercontent.com/2006548/84450699-4a791880-ac51-11ea-9c51-c0046cc273a0.png" alt="84450699 4a791880 ac51 11ea 9c51 c0046cc273a0">
</div>
</div>
<div class="paragraph">
<p>But&#8230;&#8203;</p>
</div>
<div class="sect2">
<h3 id="_the_typing_is_not_good">The typing is not good</h3>
<div class="paragraph">
<p>You should see that your import is underlined in red:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://user-images.githubusercontent.com/2006548/84450825-9c21a300-ac51-11ea-9243-78a13ecad82d.png" alt="84450825 9c21a300 ac51 11ea 9243 78a13ecad82d">
</div>
</div>
<div class="paragraph">
<p>To fix that, we will add a declaration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#under meteor-elm-app
mkdir -p types/meteor
touch types/meteor/elm-app.d.ts</code></pre>
</div>
</div>
<div class="paragraph">
<p>And add the following content</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">declare module 'meteor/elm-app' {
    export const init: (
        configuration: import('/packages/elm-app/app').Configuration,
    ) =&gt; import('/packages/elm-app/app').Ports;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now each time we will change the definition of the type <code>Flag</code> or the type <code>Port</code> inside our <a href="https://elm-lang.org/">Elm</a> application, we will be sure to know if we have some stuff to fix in the <a href="https://www.meteor.com/">Meteor</a> client 💪.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_live_reload">Live Reload</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Because we don&#8217;t want to build manually our <a href="https://elm-lang.org/">Elm</a> application each time we make a change, we will setup the live reload</p>
</div>
<div class="paragraph">
<p>We will install some packages to help us</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#under meteor-elm-app
meteor npm i -D concurrently wait-on rimraf</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we will create an new script in our <strong>package.json</strong> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"elm:watch": "parcel watch packages/elm-app/app/index.ts -d packages/elm-app/dist --out-file elm-app.js",</code></pre>
</div>
</div>
<div class="paragraph">
<p>With <code>elm:watch</code>, parcel will rebuild our app each time we make a change in <a href="https://elm-lang.org/">Elm</a>, TS or SCSS files under the folder <strong>packages/elm-app/app</strong>.</p>
</div>
<div class="paragraph">
<p>And because <code>parcel watch</code> create a <strong>.cache</strong> folder, we will add it to the <strong>.gitignore</strong> file.
The content of your <strong>.gitignore</strong> should be like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>node_modules/
dist
elm-stuff
.cache</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now to run parcel and meteor in parallel, we will update the <strong>package.json</strong> file.
We will rename the script <code>start</code> to <code>meteor:run</code>, and redefine the script <code>start</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"meteor:run": "meteor run",
"start": "rimraf \"./packages/elm-app/dist/*\" &amp;&amp; concurrently -n \"parcel,meteor\" -c \"magenta,green\" \"meteor npm run elm:watch\" \"wait-on ./packages/elm-app/dist/elm-app.js &amp;&amp; meteor npm run meteor:run\"",</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script <code>start</code> call <code>rimraf</code> to clean the <strong>dist</strong> folder, then we call <code>concurrently</code> to run two tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>parcel</code> one, that will be log in <code>magenta</code> and its command is <code>meteor npm run elm:watch</code></p>
</li>
<li>
<p>the <code>meteor</code> one, that will be log in <code>green</code> and its command is <code>wait-on ./packages/elm-app/dist/elm-app.js &amp;&amp; meteor npm run meteor:run</code> (the <code>wait-on</code> command is use to wait the build from Parcel)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now each time we will change our content under <strong>packages/elm-app/app</strong>, <a href="https://parceljs.org/">Parcel</a> will rebuild incrementally our application and update the content under the <strong>dist</strong> folder, so <a href="https://www.meteor.com/">Meteor</a> will detect a change and refresh the main application.</p>
</div>
<div class="paragraph">
<p>You can now start your application by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#under meteor-elm-app
meteor npm start</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can make some changes in your <code>Main.elm</code> file and see that everything will automatically refresh in your browser.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tailwindcss">Tailwindcss</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tailwindcss is a npm package, so we will install it like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">meteor npm i -D tailwindcss</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more informations about Tailwindcss, see <a href="https://tailwindcss.com/docs/installation" class="bare">https://tailwindcss.com/docs/installation</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We need to initialize Tailwincss:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#under meteor-elm-app/packages/elm-app/app
meteor npx tailwindcss init</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will generate a file called <strong>tailwind.config.js</strong></p>
</div>
<div class="paragraph">
<p>We can now edit the file <strong>main.scss</strong> inside our app (packages/elm-app/app/main.scss) to use <a href="https://tailwindcss.com/">Tailwindcss</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-css" data-lang="css">@tailwind base;
@tailwind components;
@tailwind utilities;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We will configure <strong>postcss</strong> to use <strong>autoprefixer</strong> and the <strong>tailwind.config.js</strong> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#under meteor-elm-app/packages/elm-app/app
touch postcss.config.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>And add this content to this file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">const path = require("path");

module.exports = {
  plugins: [
    require("tailwindcss")(path.join(__dirname, "tailwind.config.js")),
    require("autoprefixer"),
  ],
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now edit our <strong>Main.elm</strong> to add a CSS class (<code>text-green-500</code>) from Tailwindcss:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>view: Model -&gt; Html msg
view model =
    div [class "text-green-500"] [text model]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then if you (re)start your server, you should see this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://user-images.githubusercontent.com/2006548/84566211-bfdb0b00-ad6f-11ea-86fa-927a901ae327.png" alt="84566211 bfdb0b00 ad6f 11ea 86fa 927a901ae327">
</div>
</div>
<div class="paragraph">
<p>Congratulations 🎉! You made your first application with <a href="https://elm-lang.org/">Elm</a>, <a href="https://www.meteor.com/">Meteor</a> and Tailwindcss 👏.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_todos_application">The Todos application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is really awesome right? What? You don&#8217;t want to use <a href="https://www.meteor.com/">Meteor</a> just to expose static file? Hmm ok, let&#8217;s go with the Todos application</p>
</div>
<div class="paragraph">
<p>Because the goal of this post is not to learn how to code in <a href="https://elm-lang.org/">Elm</a>, we will start with an application I wrote for the occasion.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://user-images.githubusercontent.com/2006548/84833215-132eb100-b02f-11ea-836b-63a14a6dbe74.png" alt="84833215 132eb100 b02f 11ea 836b 63a14a6dbe74">
</div>
</div>
<div class="paragraph">
<p>This application is not linked with <a href="https://www.meteor.com/">Meteor</a> yet, there is no ports defined.
The goal is to save each Todo in MongoDB and to be able to sync two browser.</p>
</div>
<div class="sect2">
<h3 id="_update_the_main_elm">Update the Main.elm</h3>
<div class="paragraph">
<p>Replace the content of the Main.elm file with this gist <a href="https://gist.github.com/anthonny/1b6a73782a6ad94c611849b9a5d4cbbf" class="bare">https://gist.github.com/anthonny/1b6a73782a6ad94c611849b9a5d4cbbf</a></p>
</div>
<div class="paragraph">
<p>We will need to add <code>elm/svg</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#under meteor-elm-app/packages/elm-app/app
meteor npx elm install elm/svg</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then start your application</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>meteor npm start</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can try the application, actually we can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a Todo</p>
</li>
<li>
<p>Switch the status of a Todo</p>
</li>
<li>
<p>Filter Todos by status</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will keep the filtering part in the client, but we want to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Load Todos from MongoDB</p>
</li>
<li>
<p>Save new Todos in MongoDB</p>
</li>
<li>
<p>Switch the status and save it in MongoDB</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But let&#8217;s start with the backend</p>
</div>
</div>
<div class="sect2">
<h3 id="_define_the_todos_collection_and_methods">Define the Todos collection and methods</h3>
<div class="paragraph">
<p>Under the folder <strong>meteor-elm-app/imports/api</strong>, create a file <strong>todos.ts</strong>.</p>
</div>
<div class="paragraph">
<p>In this file we will define what is a Todo, and create the collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">import { Mongo } from "meteor/mongo";
import { Meteor } from "meteor/meteor";

export interface Todo {
  _id?: string;
  value: string;
  status: "checked" | "unchecked";
  createdAt: Date;
}

export const TodosCollection = new Mongo.Collection&lt;Todo&gt;("todos");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then in the same file, we will add two <a href="https://www.meteor.com/">Meteor</a> methods, one to add a Todo and another to switch the status of Todo with its ID:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">Meteor.methods({
  "todos.addTodo"(value: string) {
    if (value !== "") {
      TodosCollection.insert({
        value,
        status: "unchecked",
        createdAt: new Date(),
      });
    }
  },
  "todos.toggleStatus"(todoId: string) {
    const todo = TodosCollection.findOne({ _id: todoId });
    if (!todo) {
      throw new Meteor.Error("Todo not found");
    }

    const newStatus = todo.status === "checked" ? "unchecked" : "checked";

    TodosCollection.update({ _id: todoId }, { $set: { status: newStatus } });
  },
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>And at the end of the file, we will publish our collection on the server side:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">if (Meteor.isServer) {
  Meteor.publish("todos", function todos() {
    return TodosCollection.find({}, { sort: { createdAt: -1 } });
  });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally we need to import this file in the file <strong>server/main.ts</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">import "/imports/api/todos";</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server side in now ready.</p>
</div>
</div>
<div class="sect2">
<h3 id="_add_ports_to_the_elm_application">Add ports to the Elm application</h3>
<div class="paragraph">
<p>We will start by installing <code>elm/json</code> and <code>NoRedInk/elm-json-decode-pipeline</code> to decode our Todos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#under meteor-elm-app/packages/elm-app/app
meteor npx elm install elm/json
meteor npx elm install NoRedInk/elm-json-decode-pipeline</code></pre>
</div>
</div>
<div class="paragraph">
<p>So we will create 3 ports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>addTodo: <code>port addTodo : String &#8594; Cmd msg</code></p>
</li>
<li>
<p>toggleStatus: <code>port toggleStatus : String &#8594; Cmd msg</code></p>
</li>
<li>
<p>receiveTodos: <code>port receiveTodos : (Decode.Value &#8594; msg) &#8594; Sub msg</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s put these port at the end of our <strong>Main.elm</strong> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-elm" data-lang="elm">port module Main exposing(main)

import Json.Decode as Decode
import Json.Decode.Pipeline exposing (required)

...

port addTodo : String -&gt; Cmd msg

port toggleStatus : String -&gt; Cmd msg

port receiveTodos : (Decode.Value -&gt; msg) -&gt; Sub msg</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have to change the type of the Todo.id to use a <code>String</code> because of the id in Mongo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-elm" data-lang="elm">type alias Todo =
    { id : String
    , value : String
    , status : TodoStatus
    }

type Msg
    = InputChanged String
    | AddTodo
    | ToggleStatus String -- ToggleStatus now need a String not a Int
    | FilterBy Filter</code></pre>
</div>
</div>
<div class="paragraph">
<p>We need a new variant <code>ReceiveTodos (List Todo)</code> for <code>Msg</code> to receive todos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-elm" data-lang="elm">type Msg
    = InputChanged String
    | AddTodo
    | ToggleStatus String
    | FilterBy Filter
    | ReceiveTodos (List Todo)</code></pre>
</div>
</div>
<div class="paragraph">
<p>We also change the <code>update</code> function because we will not update the <code>todos</code> list anymore.
We will get the one we will receive from the port <code>receiveTodos</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-elm" data-lang="elm">update : Msg -&gt; Model -&gt; ( Model, Cmd Msg )
update msg model =
    case msg of
        InputChanged value -&gt;
            ( { model | todo = value }, Cmd.none )

        AddTodo -&gt;
            if String.isEmpty (String.trim model.todo) then
                ( model, Cmd.none )

            else
                ( { model | todo = "" }, addTodo model.todo )

        ToggleStatus todoId -&gt;
            ( model, toggleStatus todoId )

        FilterBy selectedFilter -&gt;
            ( { model | filter = selectedFilter }, Cmd.none )

        ReceiveTodos todos -&gt;
            ( { model | todos = todos }, Cmd.none )</code></pre>
</div>
</div>
<div class="paragraph">
<p>To finish with the <a href="https://elm-lang.org/">Elm</a> part, we need a subscription and some decoders to receive our Todos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-elm" data-lang="elm">subscriptions : Model -&gt; Sub Msg
subscriptions _ =
    receiveTodos
        (\value -&gt;
            Decode.decodeValue decodeTodos value
                |&gt; Result.withDefault []
                |&gt; ReceiveTodos
        )


decodeTodo : Decode.Decoder Todo
decodeTodo =
    Decode.succeed Todo
        |&gt; required "id" Decode.string
        |&gt; required "value" Decode.string
        |&gt; required "status" decodeStatus


decodeStatus : Decode.Decoder TodoStatus
decodeStatus =
    Decode.string
        |&gt; Decode.andThen
            (\status -&gt;
                case status of
                    "checked" -&gt;
                        Decode.succeed Checked

                    _ -&gt;
                        Decode.succeed Unchecked
            )


decodeTodos : Decode.Decoder (List Todo)
decodeTodos =
    Decode.list decodeTodo</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you remember, we have defined an interface <code>Ports</code> in the file <strong>meteor-elm-app/packages/elm-app/app/index.ts</strong>.
It is time to add some definitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">interface Todo {
  id: string;
  value: string;
  status: "checked" | "unchecked";
}

export interface Ports {
  addTodo?: {
    subscribe: (fn: (todo: string) =&gt; void) =&gt; void;
  };
  toggleStatus?: {
    subscribe: (fn: (todoId: string) =&gt; void) =&gt; void;
  };
  receiveTodos?: {
    send: (todos: Todo[]) =&gt; void;
  };
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_link_ports_to_meteor_methods_and_subscriptions">Link ports to Meteor.methods and subscriptions</h3>
<div class="paragraph">
<p>We have some piece of code in <a href="https://elm-lang.org/">Elm</a> and some piece of code in the server side.
Now we need to link them together, and we will do that in the file <strong>client/main.ts</strong></p>
</div>
<div class="paragraph">
<p>We will need to import our TodosCollection and the <a href="https://www.meteor.com/">Meteor</a> Tracker</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">import { Tracker } from "meteor/tracker";
import { TodosCollection } from "/imports/api/todos";</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we will subscribe to the output ports:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">  ports.addTodo?.subscribe((todo) =&gt; {
    Meteor.call("todos.addTodo", todo, (err: Error) =&gt; {
      if (err) {
        // Maybe we should pass this error to Elm
        console.log("error", err);
        return;
      }
    });
  });

  ports.toggleStatus?.subscribe((todoId) =&gt; {
    Meteor.call("todos.toggleStatus", todoId, (err: Error) =&gt; {
      if (err) {
        // Maybe we should pass this error to Elm
        console.log("error", err);
        return;
      }
    });
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here each time <code>addTodo</code> is called from <a href="https://elm-lang.org/">Elm</a>, we add a new Todo with a Meteor.call, same for the toggleStatus.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Of course we should manage the error, maybe it could be a good exercice 😁
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally we need to send todos everytime the collection change.
To do that, we use <code>Tracker.autorun</code> that will run the callback when necessary.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">  // We use the Tracker.autorun to send todos each time the fetch result
  // changes
  Tracker.autorun(() =&gt; {
    // Maybe one day we will need to manage the subscription
    const subscription = Meteor.subscribe("todos");

    const todos = TodosCollection.find({}, { sort: { createdAt: 1 } }).fetch();

    ports.receiveTodos?.send(
      todos.map((todo) =&gt; ({
        id: todo._id || "",
        value: todo.value,
        status: todo.status,
      }))
    );
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can restart your server, open two browsers on <a href="http://localhost:3000" class="bare">http://localhost:3000</a> and see that everything is saved and sync 👏.</p>
</div>
<div class="videoblock">
<div class="content">
<video src="https://anthonnyquerouil.me/images/todo-elm-meteor.mp4" width="100%" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I hope you enjoyed this content as much as I enjoyed writing it.
Three weeks ago I was sad because I could not use <a href="https://www.meteor.com/">Meteor</a> with <a href="https://elm-lang.org/">Elm</a>, so I started using it with React and Typescript 😳.</p>
</div>
<div class="paragraph">
<p>Today, I dropped React and I use <a href="https://elm-lang.org/">Elm</a> again and it is really pleasant.</p>
</div>
<div class="paragraph">
<p>If you liked this post, do not hesitate to share it on your favorite social networks and if you are interested by this kind of content, you can follow me on twitter <a href="https://twitter.com/anthonny_q">@anthonny_q</a>.</p>
</div>
<div class="paragraph">
<p>If you have any feedbacks, comments are open and you can find the sources of the project here <a href="https://github.com/anthonny/meteor-elm-todos" class="bare">https://github.com/anthonny/meteor-elm-todos</a>.</p>
</div>
<div class="paragraph">
<p>Special thanks to <a href="https://forums.meteor.com/u/ni-ko-o-kin">ni-ko-o-kin</a>, as I was very inspired by his <a href="https://forums.meteor.com/t/meteor-elm-example/50244">post</a>.</p>
</div>
<div class="paragraph">
<p>Big thanks to <a href="https://twitter.com/yanndanthu">Yann Danthu</a> for the review of this post 😘.</p>
</div>
</div>
</div>
        </section>
    </section>
</section>
        </section>
        <footer class="mt-8 py-4 flex flex-col justify-center items-center text-xs text-indigo-800">
            <section>© 2020. All Rights Reserved.</section>
            <section>
                Proudly published with
                <a href="#" class="hover:text-indigo:600 underline">HubPress</a>
            </section>
        </footer>

    </main>

    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/prism/1.14.0/prism.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        // hljs.initHighlightingOnLoad();
      </script>

    <script src="//anthonnyquerouil.me/themes/indigo-theme/assets/main.3016fceb.js?v=1592551695646"></script>



    <!-- Fathom - beautiful, simple website analytics -->
    <script src="https://cdn.usefathom.com/script.js" site="RMDAJFGG"></script>
    <!-- / Fathom -->
</body>

</html>